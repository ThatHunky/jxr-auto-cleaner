<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui"
     xmlns:util="http://wixtoolset.org/schemas/v4/wxs/util">
  
  <Package Name="JxrAutoCleaner"
           Manufacturer="ThatHunky"
           Version="1.1.1.0"
           UpgradeCode="779AB028-26D7-496F-A037-94BC1781E728"
           Scope="perUser">

    <MajorUpgrade DowngradeErrorMessage="A newer version of JxrAutoCleaner is already installed." />

    <!-- Embed the CAB file into the MSI -->
    <MediaTemplate EmbedCab="yes" />

    <!-- 
       UI Configuration: "Minimal" set
       - Welcome
       - License Agreement (eula.rtf)
       - Install/Repair/Remove
       - Success/Exit + "Launch application" checkbox
    -->
    <ui:WixUI Id="WixUI_Minimal" />
    <WixVariable Id="WixUILicenseRtf" Value="installer/license.rtf" />
    
    <!-- Checkbox on Exit Dialog to launch the app -->
    <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOXTEXT" Value="Launch JxrAutoCleaner now" />
    <Property Id="WixShellExecTarget" Value="[#JxrAutoCleanerExe]" />
    <CustomAction Id="LaunchApplication" BinaryRef="Wix4UtilCA_$(sys.BUILDARCHSHORT)" DllEntry="WixShellExec" Impersonate="yes" Return="ignore" />

    <UI>
      <Publish Dialog="ExitDialog"
               Control="Finish"
               Event="DoAction"
               Value="LaunchApplication"
               Condition="WIXUI_EXITDIALOGOPTIONALCHECKBOX = 1 and NOT Installed" />
    </UI>

    <!-- Directories -->
    <StandardDirectory Id="ProgramMenuFolder" />

    <StandardDirectory Id="LocalAppDataFolder">
      <Directory Id="INSTALLFOLDER" Name="JxrAutoCleaner">
        <Component Id="MainExecutable" Guid="2215907C-9AA9-4837-B4D6-8A5501AE8F3B">
          <File Id="JxrAutoCleanerExe"
                Source="$(BuildOutput)\JxrAutoCleaner.exe"
                KeyPath="yes">
            <Shortcut Name="JxrAutoCleaner"
                      Directory="ProgramMenuFolder"
                      WorkingDirectory="INSTALLFOLDER" />
          </File>

          <!-- Add to Windows startup -->
          <RegistryValue Root="HKCU"
                         Key="Software\Microsoft\Windows\CurrentVersion\Run"
                         Name="JxrAutoCleaner"
                         Type="string"
                         Value="[INSTALLFOLDER]JxrAutoCleaner.exe" />
        </Component>
      </Directory>
    </StandardDirectory>

    <Feature Id="Main" Title="JxrAutoCleaner" Level="1">
      <ComponentRef Id="MainExecutable" />
    </Feature>

  </Package>
</Wix>
